

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>The Singularity Config File &mdash; Singularity container 2.6 documentation</title>




    <link rel="shortcut icon" href="_static/favicon.ico"/>












  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Container Checks" href="container_checks.html" />
    <link rel="prev" title="Security" href="security.html" />


  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">


  <div class="wy-grid-for-nav">


    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">



            <a href="index.html" class="icon icon-home"> Singularity container




            <img src="_static/logo.png" class="logo" alt="Logo"/>

          </a>




              <div class="version">
                2.6
              </div>




<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">






              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="admin_quickstart.html">Administration Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="security.html">Security</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">The Singularity Config File</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#parameters">Parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#allow-setuid-boolean-default-yes">ALLOW SETUID (boolean, default=’yes’)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#allow-pid-ns-boolean-default-yes">ALLOW PID NS (boolean, default=’yes’)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#enable-overlay-boolean-default-no">ENABLE OVERLAY (boolean, default=’no’)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#config-passwd-group-resolv-conf-boolean-default-yes">CONFIG PASSWD, GROUP, RESOLV_CONF (boolean, default=’yes’)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mount-proc-sys-dev-home-tmp-boolean-default-yes">MOUNT PROC,SYS,DEV,HOME,TMP (boolean, default=’yes’)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mount-hostfs-boolean-default-no">MOUNT HOSTFS (boolean, default=’no’)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bind-path-string">BIND PATH (string)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#user-bind-control-boolean-default-yes">USER BIND CONTROL (boolean, default=’yes’)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#autofs-bug-path-string">AUTOFS BUG PATH (string)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#logging">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="#loop-devices">Loop Devices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="container_checks.html">Container Checks</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation_environments.html">Installation Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix.html">Appendix</a></li>
</ul>



        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">


      <nav class="wy-nav-top" aria-label="top navigation">

          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Singularity container</a>

      </nav>


      <div class="wy-nav-content">

        <div class="rst-content style-external-links">

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">

      <li><a href="index.html">Docs</a> &raquo;</li>

      <li>The Singularity Config File</li>


      <li class="wy-breadcrumbs-aside">



              <a href="https://github.com/sylabs/singularity-admindocs/blob/master/the_singularity_config_file.rst" class="fa fa-github"> Edit on GitHub</a>



      </li>

  </ul>


  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">

  <div class="section" id="the-singularity-config-file">
<h1>The Singularity Config File<a class="headerlink" href="#the-singularity-config-file" title="Permalink to this headline">¶</a></h1>
<p>When Singularity is running via the SUID pathway, the configuration
<strong>must</strong> be owned by the root user otherwise Singularity will error
out. This ensures that the system administrators have direct say as to
what functions the users can utilize when running as root. If
Singularity is installed as a non-root user, the SUID components are
not installed, and the configuration file can be owned by the user
(but again, this will limit functionality).
The Configuration file can be found at <code class="docutils literal notranslate"><span class="pre">$SYSCONFDIR/singularity/singularity.conf</span></code>. The template in the
repository is located at <code class="docutils literal notranslate"><span class="pre">etc/singularity.conf</span></code>. It is generally self documenting but there
are several things to pay special attention to:</p>
<div class="section" id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h2>
<div class="section" id="allow-setuid-boolean-default-yes">
<h3>ALLOW SETUID (boolean, default=’yes’)<a class="headerlink" href="#allow-setuid-boolean-default-yes" title="Permalink to this headline">¶</a></h3>
<p>This parameter toggles the global ability to execute the SETUID (SUID)
portion of the code if it exists. As mentioned earlier, if the SUID
features are disabled, various Singularity features will not function
(e.g. mounting of the Singularity image file format).
You can however disable SUID support <strong>iff</strong> (if and only if) you do
not need to use the default Singularity image file format and if your
kernel supports user namespaces and you choose to use user namespaces.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As of the time of this writing, the user namespace is rather
buggy</p>
</div>
</div>
<div class="section" id="allow-pid-ns-boolean-default-yes">
<h3>ALLOW PID NS (boolean, default=’yes’)<a class="headerlink" href="#allow-pid-ns-boolean-default-yes" title="Permalink to this headline">¶</a></h3>
<p>While the PID namespace is a neat feature, it does not have much
practical usage in an HPC context so it is recommended to disable this
if you are running on an HPC system where a resource manager is
involved as it has been known to cause confusion on some kernels with
enforcement of user limits.
Even if the PID namespace is enabled by the system administrator here,
it is not implemented by default when running containers. The user
will have to specify they wish to implement un-sharing of the PID
namespace as it must fork a child process.</p>
</div>
<div class="section" id="enable-overlay-boolean-default-no">
<h3>ENABLE OVERLAY (boolean, default=’no’)<a class="headerlink" href="#enable-overlay-boolean-default-no" title="Permalink to this headline">¶</a></h3>
<p>The overlay file system creates a writable substrate to create bind
points if necessary. This feature is very useful when implementing bind
points within containers where the bind point may not already exist so
it helps with portability of containers. Enabling this option has been
known to cause some kernels to panic as this feature maybe present
within a kernel, but has not proved to be stable as of the time of this
writing (e.g. the Red Hat 7.2 kernel).</p>
</div>
<div class="section" id="config-passwd-group-resolv-conf-boolean-default-yes">
<h3>CONFIG PASSWD, GROUP, RESOLV_CONF (boolean, default=’yes’)<a class="headerlink" href="#config-passwd-group-resolv-conf-boolean-default-yes" title="Permalink to this headline">¶</a></h3>
<p>All of these options essentially do the same thing for different files
within the container. This feature updates the described file (<code class="docutils literal notranslate"><span class="pre">/etc/passwd</span></code>, <code class="docutils literal notranslate"><span class="pre">/etc/group</span></code> , and <code class="docutils literal notranslate"><span class="pre">/etc/resolv.conf</span></code>
respectively) to be updated dynamically as the container is executed. It
uses binds and modifies temporary files such that the original files are
not manipulated.</p>
</div>
<div class="section" id="mount-proc-sys-dev-home-tmp-boolean-default-yes">
<h3>MOUNT PROC,SYS,DEV,HOME,TMP (boolean, default=’yes’)<a class="headerlink" href="#mount-proc-sys-dev-home-tmp-boolean-default-yes" title="Permalink to this headline">¶</a></h3>
<p>These configuration options control the mounting of these file systems
within the container and of course can be overridden by the system
administrator (e.g. the system admin decides not to include the /dev
tree inside the container). In most useful cases, these are all best to
leave enabled.</p>
</div>
<div class="section" id="mount-hostfs-boolean-default-no">
<h3>MOUNT HOSTFS (boolean, default=’no’)<a class="headerlink" href="#mount-hostfs-boolean-default-no" title="Permalink to this headline">¶</a></h3>
<p>This feature will parse the host’s mounted file systems and attempt to
replicate all mount points within the container. This maybe a desirable
feature for the lazy, but it is generally better to statically define
what bind points you wish to encapsulate within the container by hand
(using the below “bind path” feature).</p>
</div>
<div class="section" id="bind-path-string">
<h3>BIND PATH (string)<a class="headerlink" href="#bind-path-string" title="Permalink to this headline">¶</a></h3>
<p>With this configuration directive, you can specify any number of bind
points that you want to extend from the host system into the
container. Bind points on the host file system must be either real
files or directories (no special files supported at this time). If the
overlayFS is not supported on your host, or if <code class="docutils literal notranslate"><span class="pre">enable</span> <span class="pre">overlay</span> <span class="pre">=</span> <span class="pre">no</span></code> in this configuration
file, a bind point must exist for the file or directory within the
container.
The syntax for this consists of a bind path source and an optional
bind path destination separated by a colon. If no bind path
destination is specified, the bind path source is used also as the
destination.</p>
</div>
<div class="section" id="user-bind-control-boolean-default-yes">
<h3>USER BIND CONTROL (boolean, default=’yes’)<a class="headerlink" href="#user-bind-control-boolean-default-yes" title="Permalink to this headline">¶</a></h3>
<p>In addition to the system bind points as specified within this
configuration file, you may also allow users to define their own bind
points inside the container. This feature is used via multiple command
line arguments (e.g. <code class="docutils literal notranslate"><span class="pre">--bind</span></code>, <code class="docutils literal notranslate"><span class="pre">--scratch</span></code> , and <code class="docutils literal notranslate"><span class="pre">--home</span></code>) so disabling user bind control will
also disable those command line options.
Singularity will automatically disable this feature if the host does
not support the prctl option <code class="docutils literal notranslate"><span class="pre">PR_SET_NO_NEW_PRIVS</span></code>. In addition, <code class="docutils literal notranslate"><span class="pre">enable</span> <span class="pre">overlay</span></code> must be set to <code class="docutils literal notranslate"><span class="pre">yes</span></code> and the
host system must support overlayFS (generally kernel versions 3.18 and
later) for users to bind host directories to bind points that do not
already exist in the container.</p>
</div>
<div class="section" id="autofs-bug-path-string">
<h3>AUTOFS BUG PATH (string)<a class="headerlink" href="#autofs-bug-path-string" title="Permalink to this headline">¶</a></h3>
<p>With some versions of autofs, Singularity will fail to run with a “Too
many levels of symbolic links” error. This error happens by way of a
user requested bind (done with -B/–bind) or one specified via the
configuration file. To handle this, you will want to specify those
paths using this directive. For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>autofs bug path = /share/PI
</pre></div>
</div>
</div>
</div>
<div class="section" id="logging">
<h2>Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h2>
<p>In order to facilitate monitoring and auditing, Singularity will
syslog() every action and error that takes place to the <code class="docutils literal notranslate"><span class="pre">LOCAL0</span></code> syslog facility.
You can define what to do with those logs in your syslog configuration.</p>
</div>
<div class="section" id="loop-devices">
<h2>Loop Devices<a class="headerlink" href="#loop-devices" title="Permalink to this headline">¶</a></h2>
<p>Singularity images have <code class="docutils literal notranslate"><span class="pre">ext3</span></code> file systems embedded within them, and thus to
mount them, we need to convert the raw file system image (with
variable offset) to a block device. To do this, Singularity utilizes
the <code class="docutils literal notranslate"><span class="pre">/dev/loop*</span></code> block devices on the host system and manages the devices
programmatically within Singularity itself. Singularity also uses the <code class="docutils literal notranslate"><span class="pre">LO_FLAGS_AUTOCLEAR</span></code>
loop device <code class="docutils literal notranslate"><span class="pre">ioctl()</span></code> flag which tells the kernel to automatically free the loop
device when there are no more open file descriptors to the device
itself.
Earlier versions of Singularity managed the loop devices via a
background watchdog process, but since version 2.2 we leverage the <code class="docutils literal notranslate"><span class="pre">LO_FLAGS_AUTOCLEAR</span></code>
functionality and we forego the watchdog process. Unfortunately, this
means that some older Linux distributions are no longer supported
(e.g. RHEL &lt;= 5).
Given that loop devices are consumable (there are a limited number of
them on a system), Singularity attempts to be smart in how loop
devices are allocated. For example, if a given user executes a
specific container it will bind that image to the next available loop
device automatically. If that same user executes another command on
the same container, it will use the loop device that has already been
allocated instead of binding to another loop device. Most Linux
distributions only support 8 loop devices by default, so if you find
that you have a lot of different users running Singularity containers,
you may need to increase the number of loop devices that your system
supports by doing the following:
Edit or create the file <code class="docutils literal notranslate"><span class="pre">/etc/modprobe.d/loop.conf</span></code> and add the following line:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>options loop max_loop=128
</pre></div>
</div>
<p>After making this change, you should be able to reboot your system or
unload/reload the loop device as root using the following commands:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># modprobe -r loop

# modprobe loop
</pre></div>
</div>
</div>
</div>


           </div>

          </div>
          <footer>

    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">

        <a href="container_checks.html" class="btn btn-neutral float-right" title="Container Checks" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>


        <a href="security.html" class="btn btn-neutral" title="Security" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>

    </div>


  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Singularity.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>


<script type="text/javascript" src="_static/js/footer.js"></script>


    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.6.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>



  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

</body>
</html>
